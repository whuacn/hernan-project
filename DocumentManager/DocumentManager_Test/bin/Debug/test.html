<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<title>Test document</title>
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
@font-face
	{font-family:Cambria;
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Verdana;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:Consolas;
	panose-1:2 11 6 9 2 2 4 3 2 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:0cm;
	margin-right:0cm;
	margin-bottom:10.0pt;
	margin-left:0cm;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
h1
	{mso-style-link:"Título 1 Car";
	margin-top:24.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Cambria","serif";
	color:#365F91;
	font-weight:bold;}
h2
	{mso-style-link:"Título 2 Car";
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	line-height:115%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Arial","sans-serif";
	font-weight:bold;
	font-style:italic;}
h3
	{mso-style-link:"Título 3 Car";
	margin-top:12.0pt;
	margin-right:0cm;
	margin-bottom:3.0pt;
	margin-left:0cm;
	line-height:115%;
	page-break-after:avoid;
	font-size:13.0pt;
	font-family:"Arial","sans-serif";
	font-weight:bold;}
p.MsoTitle, li.MsoTitle, div.MsoTitle
	{mso-style-link:"Puesto Car";
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:15.0pt;
	margin-left:0cm;
	border:none;
	padding:0cm;
	font-size:26.0pt;
	font-family:"Cambria","serif";
	color:#17365D;
	letter-spacing:.25pt;}
p.MsoTitleCxSpFirst, li.MsoTitleCxSpFirst, div.MsoTitleCxSpFirst
	{mso-style-link:"Puesto Car";
	margin:0cm;
	margin-bottom:.0001pt;
	border:none;
	padding:0cm;
	font-size:26.0pt;
	font-family:"Cambria","serif";
	color:#17365D;
	letter-spacing:.25pt;}
p.MsoTitleCxSpMiddle, li.MsoTitleCxSpMiddle, div.MsoTitleCxSpMiddle
	{mso-style-link:"Puesto Car";
	margin:0cm;
	margin-bottom:.0001pt;
	border:none;
	padding:0cm;
	font-size:26.0pt;
	font-family:"Cambria","serif";
	color:#17365D;
	letter-spacing:.25pt;}
p.MsoTitleCxSpLast, li.MsoTitleCxSpLast, div.MsoTitleCxSpLast
	{mso-style-link:"Puesto Car";
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:15.0pt;
	margin-left:0cm;
	border:none;
	padding:0cm;
	font-size:26.0pt;
	font-family:"Cambria","serif";
	color:#17365D;
	letter-spacing:.25pt;}
a:link, span.MsoHyperlink
	{font-family:"Times New Roman","serif";
	color:navy;
	text-decoration:none;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;}
em
	{font-family:"Times New Roman","serif";}
p
	{margin-top:7.5pt;
	margin-right:0cm;
	margin-bottom:7.5pt;
	margin-left:0cm;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
span.Ttulo1Car
	{mso-style-name:"Título 1 Car";
	mso-style-link:"Título 1";
	font-family:"Cambria","serif";
	color:#365F91;
	font-weight:bold;}
span.Ttulo2Car
	{mso-style-name:"Título 2 Car";
	mso-style-link:"Título 2";
	font-family:"Cambria","serif";
	font-weight:bold;
	font-style:italic;}
span.Ttulo3Car
	{mso-style-name:"Título 3 Car";
	mso-style-link:"Título 3";
	font-family:"Cambria","serif";
	font-weight:bold;}
span.PuestoCar
	{mso-style-name:"Puesto Car";
	mso-style-link:Puesto;
	font-family:"Cambria","serif";
	color:#17365D;
	letter-spacing:.25pt;}
span.kwrd3
	{mso-style-name:kwrd3;
	font-family:"Times New Roman","serif";
	color:blue;}
span.rem3
	{mso-style-name:rem3;
	font-family:"Times New Roman","serif";
	color:green;}
.MsoChpDefault
	{font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
@page WordSection1
	{size:595.3pt 841.9pt;
	margin:70.85pt 70.85pt 70.85pt 70.85pt;}
div.WordSection1
	{page:WordSection1;}
-->
</style>

</head>

<body lang=ES link=navy vlink=purple>

<div class=WordSection1>

<div style='border:none;border-bottom:solid #4F81BD 1.0pt;padding:0cm 0cm 4.0pt 0cm'>

<p class=MsoTitle><span lang=EN-US>ASP.NET MVC framework - Security</span></p>

</div>

<p style='background:white'><span lang=EN-GB style='font-size:9.0pt;font-family:
"Verdana","sans-serif"'>Some </span><span lang=NL><a
href="http://blog.maartenballiauw.be/post/2007/12/ASPNET-MVC-Framework---Basic-sample-application.aspx"
target="_blank"><span lang=EN-GB style='font-size:9.0pt;font-family:"Verdana","sans-serif"'>posts
ago</span></a></span><span lang=EN-GB style='font-size:9.0pt;font-family:"Verdana","sans-serif"'>,
I started playing with the ASP.NET MVC framework. In an example I'm creating,
I'm trying to add Forms-based security. </span></p>

<p style='background:white'><span lang=EN-GB style='font-size:9.0pt;font-family:
"Verdana","sans-serif"'>&quot;Classic&quot; ASP.NET offers a nice and easy way
to set security on different pages in a web application, trough Web.config. In
the example I'm building, I wanted to allow access to
&quot;/Entry/Delete/&quot; only to users with the role
&quot;Administrator&quot;. So I gave the following snip a try: </span></p>

<p class=MsoNormal style='margin-top:7.5pt;margin-right:0cm;margin-bottom:7.5pt;
margin-left:0cm;background:#F1F1F1'><span lang=EN-GB style='font-size:9.0pt;
line-height:115%;font-family:Consolas;color:black'>&lt;location
path=&quot;/Entry/Delete&quot;&gt;<br>
&nbsp;&nbsp; &lt;system.web&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &lt;authorization&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;allow
roles=&quot;Administrators&quot;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;deny users=&quot;*&quot;/&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp; &lt;/authorization&gt;<br>
&nbsp;&nbsp; &lt;/system.web&gt;<br>
&lt;/location&gt; </span></p>

<p style='background:white'><span lang=EN-GB style='font-size:9.0pt;font-family:
"Verdana","sans-serif"'>This seems to work in some occasions, but not always.
Second, I think it is very confusing to define security in a different place
than my route table... Since the ASP.NET MVC framework is built around
&quot;dynamically&quot; changing URL schemes, I'm not planning to maintain my
Web.config security for each change... </span></p>

<p style='background:white'><span lang=EN-GB style='font-size:9.0pt;font-family:
"Verdana","sans-serif"'>In an ideal world, you would specify permissions for a
route at the same location as you specify the route. Since the ASP.NET MVC framework
is still an </span><span lang=NL><a
href="http://weblogs.asp.net/scottgu/archive/2007/12/09/asp-net-3-5-extensions-ctp-preview-released.aspx"
target="_blank"><span lang=EN-GB style='font-size:9.0pt;font-family:"Verdana","sans-serif"'>early
CTP</span></a></span><span lang=EN-GB style='font-size:9.0pt;font-family:"Verdana","sans-serif"'>,
perhaps this might be added in future versions. For now, the follwing
strategies can be used. </span></p>

<h2 style='background:white'><span lang=EN-GB style='font-size:9.0pt;
line-height:115%;font-family:"Verdana","sans-serif"'>Code Access Security</span></h2>

<p style='background:white'><span lang=EN-GB style='font-size:9.0pt;font-family:
"Verdana","sans-serif"'>Luckily, the .NET framework offers a nice feature under
the name &quot;CAS&quot; (Code Access Security). Sounds scary? Perhaps, but
it's useful in the MVC security context! </span></p>

<p style='background:white'><span lang=EN-GB style='font-size:9.0pt;font-family:
"Verdana","sans-serif"'>The idea behind CAS is that you specify security
requirements using attributes. For example, if authentication is required in my
<em><span style='font-family:"Verdana","sans-serif"'>EntryController</span></em>
(serving /Entry/...), I could use the following code snippet: </span></p>

<p class=MsoNormal style='margin-top:7.5pt;margin-right:0cm;margin-bottom:7.5pt;
margin-left:0cm;background:#F1F1F1'><span lang=EN-GB style='font-size:9.0pt;
line-height:115%;font-family:Consolas;color:black'>[PrincipalPermission(SecurityAction.Demand,
Authenticated=</span><span class=kwrd3><span lang=EN-GB style='font-size:9.0pt;
line-height:115%;font-family:Consolas'>true</span></span><span lang=EN-GB
style='font-size:9.0pt;line-height:115%;font-family:Consolas;color:black'>)]<br>
</span><span class=kwrd3><span lang=EN-GB style='font-size:9.0pt;line-height:
115%;font-family:Consolas'>public</span></span><span lang=EN-GB
style='font-size:9.0pt;line-height:115%;font-family:Consolas;color:black'> </span><span
class=kwrd3><span lang=EN-GB style='font-size:9.0pt;line-height:115%;
font-family:Consolas'>class</span></span><span lang=EN-GB style='font-size:
9.0pt;line-height:115%;font-family:Consolas;color:black'> EntryController :
Controller {<br>
&nbsp;&nbsp;&nbsp; </span><span class=rem3><span lang=EN-GB style='font-size:
9.0pt;line-height:115%;font-family:Consolas'>// ...</span></span><span
lang=EN-GB style='font-size:9.0pt;line-height:115%;font-family:Consolas;
color:green'><br>
</span><span lang=EN-GB style='font-size:9.0pt;line-height:115%;font-family:
Consolas;color:black'>} </span></p>

<p style='background:white'><span lang=EN-GB style='font-size:9.0pt;font-family:
"Verdana","sans-serif"'>Now let's try my example from the beginning of this
post. The URL &quot;/Entry/Delete&quot; is routed to my <em><span
style='font-family:"Verdana","sans-serif"'>EntryController</span></em>'s <em><span
style='font-family:"Verdana","sans-serif"'>Delete</span></em> method. So why
not decorate that method with a CAS attribute? </span></p>

<p class=MsoNormal style='margin-top:7.5pt;margin-right:0cm;margin-bottom:7.5pt;
margin-left:0cm;background:#F1F1F1'><span lang=EN-GB style='font-size:9.0pt;
line-height:115%;font-family:Consolas;color:black'>[ControllerAction]<br>
[PrincipalPermission(SecurityAction.Demand, Role=&quot;Administrator&quot;]<br>
</span><span class=kwrd3><span lang=EN-GB style='font-size:9.0pt;line-height:
115%;font-family:Consolas'>public</span></span><span lang=EN-GB
style='font-size:9.0pt;line-height:115%;font-family:Consolas;color:black'> </span><span
class=kwrd3><span lang=EN-GB style='font-size:9.0pt;line-height:115%;
font-family:Consolas'>void</span></span><span lang=EN-GB style='font-size:9.0pt;
line-height:115%;font-family:Consolas;color:black'> Delete(</span><span
class=kwrd3><span lang=EN-GB style='font-size:9.0pt;line-height:115%;
font-family:Consolas'>int</span></span><span lang=EN-GB style='font-size:9.0pt;
line-height:115%;font-family:Consolas;color:black'>? id) {<br>
&nbsp;&nbsp; ...<br>
} </span></p>

<p style='background:white'><span lang=EN-GB style='font-size:9.0pt;font-family:
"Verdana","sans-serif"'>This snippet makes sure the <em><span style='font-family:
"Verdana","sans-serif"'>Delete</span></em> method can only be called by users
in the role &quot;Administrator&quot; </span></p>

<h2 style='background:white'><span lang=EN-GB style='font-size:9.0pt;
line-height:115%;font-family:"Verdana","sans-serif"'>Exception handling</span></h2>

<p style='background:white'><span lang=EN-GB style='font-size:9.0pt;font-family:
"Verdana","sans-serif"'>Problem using the CAS approach is that you are
presented an ugly error when a security requirement is not met. There are two
possible alternatives for catching these Exceptions. </span></p>

<h3 style='background:white'><span lang=EN-GB style='font-size:11.0pt;
line-height:115%;font-family:"Verdana","sans-serif"'>Alternative 1: Using
Global.asax</span></h3>

<p style='background:white'><span lang=EN-GB style='font-size:9.0pt;font-family:
"Verdana","sans-serif"'>In Global.asax, you can specify an <em><span
style='font-family:"Verdana","sans-serif"'>Application_Error</span></em> event
handler. Within this event handler, you can catch specific types of Exceptions
and route them to the right error page. The following example redirects each <em><span
style='font-family:"Verdana","sans-serif"'>SecurityException</span></em> to the
/Login, my <em><span style='font-family:"Verdana","sans-serif"'>LoginController</span></em>:
</span></p>

<p class=MsoNormal style='margin-top:7.5pt;margin-right:0cm;margin-bottom:7.5pt;
margin-left:0cm;background:#F1F1F1'><span class=kwrd3><span lang=EN-GB
style='font-size:9.0pt;line-height:115%;font-family:Consolas'>protected</span></span><span
lang=EN-GB style='font-size:9.0pt;line-height:115%;font-family:Consolas;
color:black'> </span><span class=kwrd3><span lang=EN-GB style='font-size:9.0pt;
line-height:115%;font-family:Consolas'>void</span></span><span lang=EN-GB
style='font-size:9.0pt;line-height:115%;font-family:Consolas;color:black'>
Application_Error(</span><span class=kwrd3><span lang=EN-GB style='font-size:
9.0pt;line-height:115%;font-family:Consolas'>object</span></span><span
lang=EN-GB style='font-size:9.0pt;line-height:115%;font-family:Consolas;
color:black'> sender, EventArgs e) {<br>
&nbsp;&nbsp;&nbsp; Exception ex = Server.GetLastError().GetBaseException();<br>
&nbsp;&nbsp;&nbsp; </span><span class=kwrd3><span lang=EN-GB style='font-size:
9.0pt;line-height:115%;font-family:Consolas'>if</span></span><span lang=EN-GB
style='font-size:9.0pt;line-height:115%;font-family:Consolas;color:black'> (ex </span><span
class=kwrd3><span lang=EN-GB style='font-size:9.0pt;line-height:115%;
font-family:Consolas'>is</span></span><span lang=EN-GB style='font-size:9.0pt;
line-height:115%;font-family:Consolas;color:black'> SecurityException) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Response.Redirect(&quot;/Login&quot;);<br>
&nbsp;&nbsp;&nbsp; }<br>
} </span></p>

<h3 style='background:white'><span lang=EN-GB style='font-size:11.0pt;
line-height:115%;font-family:"Verdana","sans-serif"'>Alternative 2: Use more
attributes!</span></h3>

<p style='background:white'><span lang=NL><a
href="http://weblogs.asp.net/fredriknormen/archive/2007/11/19/asp-net-mvc-framework-exception-handling.aspx"
target="_blank"><span lang=EN-GB style='font-size:9.0pt;font-family:"Verdana","sans-serif"'>Fredrik
Normén</span></a></span><span lang=EN-GB style='font-size:9.0pt;font-family:
"Verdana","sans-serif"'> has posted an </span><span lang=NL><a
href="http://weblogs.asp.net/fredriknormen/archive/2007/11/19/asp-net-mvc-framework-exception-handling.aspx"
target="_blank"><span lang=EN-GB style='font-size:9.0pt;font-family:"Verdana","sans-serif"'>ExceptionHandler
attribute</span></a></span><span lang=EN-GB style='font-size:9.0pt;font-family:
"Verdana","sans-serif"'> on his blog, which allows you to specify which type of
Exception should be handled by which type of view. Hope this makes it into a
future ASP.NET MVC framework version too! </span></p>

<h3 style='background:white'><span lang=EN-GB style='font-size:11.0pt;
line-height:115%;font-family:"Verdana","sans-serif"'>Alternative 3: Use in-line
CAS</span></h3>

<p style='background:white'><span lang=EN-GB style='font-size:9.0pt;font-family:
"Verdana","sans-serif"'>Another option is to use in-line CAS. For example, you
can do the folluwing in your <em><span style='font-family:"Verdana","sans-serif"'>ControllerAction</span></em>:
</span></p>

<p class=MsoNormal style='margin-top:7.5pt;margin-right:0cm;margin-bottom:7.5pt;
margin-left:0cm;background:#F1F1F1'><span class=kwrd3><span lang=EN-GB
style='font-size:9.0pt;line-height:115%;font-family:Consolas'>try</span></span><span
lang=EN-GB style='font-size:9.0pt;line-height:115%;font-family:Consolas;
color:black'> {<br>
&nbsp;&nbsp;&nbsp; PrincipalPermission permission = </span><span class=kwrd3><span
lang=EN-GB style='font-size:9.0pt;line-height:115%;font-family:Consolas'>new</span></span><span
lang=EN-GB style='font-size:9.0pt;line-height:115%;font-family:Consolas;
color:black'> PrincipalPermission(User.Identity.Name,
&quot;Administrators&quot;, </span><span class=kwrd3><span lang=EN-GB
style='font-size:9.0pt;line-height:115%;font-family:Consolas'>true</span></span><span
lang=EN-GB style='font-size:9.0pt;line-height:115%;font-family:Consolas;
color:black'>);<br>
&nbsp;&nbsp;&nbsp; permission.Demand();<br>
} </span><span class=kwrd3><span lang=EN-GB style='font-size:9.0pt;line-height:
115%;font-family:Consolas'>catch</span></span><span lang=EN-GB
style='font-size:9.0pt;line-height:115%;font-family:Consolas;color:black'>
(SecurityException secEx) {<br>
&nbsp;&nbsp;&nbsp; </span><span class=rem3><span lang=EN-GB style='font-size:
9.0pt;line-height:115%;font-family:Consolas'>// Handle the Exception here...</span></span><span
lang=EN-GB style='font-size:9.0pt;line-height:115%;font-family:Consolas;
color:green'><br>
</span><span lang=EN-GB style='font-size:9.0pt;line-height:115%;font-family:
Consolas;color:black'>&nbsp;&nbsp;&nbsp; </span><span class=rem3><span
lang=NL-BE style='font-size:9.0pt;line-height:115%;font-family:Consolas'>//
Redirect to Login page, for example.</span></span><span lang=NL-BE
style='font-size:9.0pt;line-height:115%;font-family:Consolas;color:green'><br>
</span><span lang=NL-BE style='font-size:9.0pt;line-height:115%;font-family:
Consolas;color:black'>} </span></p>

<p class=MsoNormal><span lang=EN-US>&nbsp;</span></p>

</div>

</body>

</html>
